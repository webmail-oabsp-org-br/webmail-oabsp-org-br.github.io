/**
 * Roundcube functions for default skin interface
 *
 * Copyright (c) 2013, The Roundcube Dev Team
 *
 * The contents are subject to the Creative Commons Attribution-ShareAlike
 * License. It is allowed to copy, distribute, transmit and to adapt the work
 * by keeping credits to the original autors in the README file.
 * See http://creativecommons.org/licenses/by-sa/3.0/ for details.
 *
 * @license magnet:?xt=urn:btih:90dc5c0be029de84e523b9b3922520e79e0e6f08&dn=cc0.txt CC0-1.0
 */
/*
 magnet:?xt=urn:btih:90dc5c0be029de84e523b9b3922520e79e0e6f08&dn=cc0.txt CC0-1.0
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,m,k){d instanceof String&&(d=String(d));for(var g=d.length,n=0;n<g;n++){var b=d[n];if(m.call(k,b,n,d))return{i:n,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,m,k){d!=Array.prototype&&d!=Object.prototype&&(d[m]=k.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,m,k,g){if(m){k=$jscomp.global;d=d.split(".");for(g=0;g<d.length-1;g++){var n=d[g];n in k||(k[n]={});k=k[n]}d=d[d.length-1];g=k[d];m=m(g);m!=g&&null!=m&&$jscomp.defineProperty(k,d,{configurable:!0,writable:!0,value:m})}};$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,k){return $jscomp.findInternal(this,d,k).v}},"es6","es3");
function rcube_mail_ui(){function d(a){p||(p=window.localStorage?rcmail.local_storage_get_item("prefs.skymail",{}):{});if(null==p[a]){var c=rcmail.get_cookie(a);null!=c&&(p[a]=c,window.localStorage&&(rcmail.local_storage_set_item("prefs.skymail",p),rcmail.set_cookie(a,c,new Date)))}return p[a]}function m(){var a=function(a,c){$("#ordermenu .toolbarmenu .active").each(function(){var e=$(this);"col"==e.data("type")&&e.data("value")==c&&(e.addClass("selected"),$(".label-order .field-classified").text(e.html()));
"order"==e.data("type")&&e.data("value")==a&&(e.addClass("selected"),$(".label-order .direction").removeClass("asc"),$(".label-order .direction").removeClass("desc"),$(".label-order .direction").addClass(a.toLowerCase()))})},c=function(c){if(c){var e=$(c.target);if(!e.hasClass("active"))return;e.closest("ul").find("a").each(function(){var a=$(this);a.data("type")==e.data("type")&&(a.removeClass("selected"),e.addClass("selected"))});b=rcmail.env.sort_col;c=rcmail.env.sort_order;"col"==e.data("type")?
b=e.data("value"):"order"==e.data("type")&&(c=e.data("value").toUpperCase())}else{c=rcmail.env.sort_order?rcmail.env.sort_order:"DESC";var b=rcmail.env.sort_col?rcmail.env.sort_col:"arrival";"date"==b&&(b="arrival")}a(c,b);rcmail.set_list_options(null,b,c,rcmail.env.threading)};$("#ordermenu .toolbarmenu").click(function(a){c(a)});c()}function k(a,c){p[a]=c;if(window.localStorage)rcmail.local_storage_set_item("prefs.skymail",p);else{var e=new Date;e.setYear(e.getFullYear()+1);rcmail.set_cookie(a,
c,e)}}function g(a){a=a?10:0;rcmail.resize_timeout&&window.clearTimeout(rcmail.resize_timeout);rcmail.resize_timeout=window.setTimeout(function(){"mail"==rcmail.env.task&&("show"==rcmail.env.action||"preview"==rcmail.env.action?f():"compose"==rcmail.env.action&&v());$("body.iframe .footerleft").each(function(){var a=$(this),e=$(document.body),b=a.hasClass("floating"),d=e.outerHeight(!0)>$(window).height();d!=b&&(b=d?"addClass":"removeClass",a[b]("floating"),e[b]("floatingbuttons"))})},a)}function n(a){var c=
$(a.object).siblings("div");c.length&&$(a.object).insertBefore(c.first());if("error"==a.type&&"login"!=rcmail.env.task){rcmail.hide_message(a.object);l.message_timer&&window.clearTimeout(l.message_timer);l.messagedialog||(l.messagedialog=$("<div>").addClass("popupdialog").hide());c=a.message;var e=function(){l.messagedialog.is(":visible")&&l.messagedialog.dialog("destroy").hide()};l.messagedialog.is(":visible")&&l.messagedialog.text()!=c&&(c=l.messagedialog.html()+"<p>"+a.message+"</p>");l.messagedialog.html(c).dialog({resizable:!1,
closeOnEscape:!0,dialogClass:a.type,title:rcmail.gettext("errortitle"),close:e,hide:{effect:"fadeOut"},width:420,minHeight:90}).show();l.messagedialog.closest("div[role=dialog]").attr("role","alertdialog");0<a.timeout&&(l.message_timer=window.setTimeout(e,a.timeout))}}function b(a){var c=a?a.new_layout:rcmail.env.layout,e=$("#mailview-top"),b=$("#mailview-bottom");a&&$("#mainscreencontent").removeClass().addClass(c);$("#mailviewsplitter")["desktop"==c?"show":"hide"]();$("#mailviewsplitter2")["widescreen"==
c?"show":"hide"]();$("#mailpreviewframe")["list"!=c?"show":"hide"]();rcmail.env.contentframe="list"==c?null:"messagecontframe";"widescreen"==c?($("#countcontrols").detach().appendTo($("#messagelistheader")),e.css({height:"auto",width:394}),b.css({top:0,left:406,height:"auto"}).show(),t?t.resize():(t=new rcube_splitter({id:"mailviewsplitter2",p1:"#mailview-top",p2:"#mailview-bottom",orientation:"v",relative:!0,start:416,min:400,size:12}),t.init())):"desktop"==c?(e.css({height:270,width:"auto"}),b.css({left:0,
top:284,height:"auto"}).show(),u?u.resize():(u=new rcube_splitter({id:"mailviewsplitter",p1:"#mailview-top",p2:"#mailview-bottom",orientation:"h",relative:!0,start:276,min:150,size:12,offset:4}),u.init())):(e.css({height:"auto",width:"auto"}),b.hide());a&&"widescreen"==a.old_layout&&$("#countcontrols").detach().appendTo($("#messagelistfooter"))}function f(){$("#messagecontent").css("top",$("#messageheader").outerHeight()+1+"px");$("#message-objects div a").addClass("button");$("#attachment-list li").length||
($("div.rightcol").hide().attr("aria-hidden","true"),$("div.leftcol").css("margin-right","0"));var a=$("#messagebody.mailvelope, #messagebody > .mailvelope");if(a.length){var c=$("#messagecontent").length?$("#messagecontent").height()-16:$(window).height()-a.offset().top-2;a.height(c)}}function M(a){}function F(a){}function G(a){if("TEXTAREA"==a.nodeName){var c=$(a),e=a.scrollHeight;c.css("height",10*(80<a.value.length&&15<e?2:1)+"px");v()}}function v(){var a=$("#composebody"),c=$("#compose-content"),
e=$("#composeview-bottom"),b=c.height()-e.position().top;ovflw=300-b;btns=-100<ovflw?0:40;e.height(Math.max(300,b));c.css("overflow",0<ovflw?"auto":"hidden");w=a.parent().width()-5;c=$("#messagetoolbar").length?$("#messagetoolbar").outerHeight():0;e=$("#composebodycontainer").length?$("#composebodycontainer").outerHeight():0;a.width(w).height(e);$("#composebodycontainer > div").width(w);$("#composebody_ifr").height(e-c-25);$("#googie_edit_layer").width(w).height(e);a=$("#directorylist");a.length&&
$("#compose-contacts .scroller").css("top",a.position().top+a.outerHeight())}function C(a){var c=$("#quotadisplay"),e=$("#quotamenu"),b=a.total?24*Math.ceil(a.percent/100*20):0;a.total&&480==b&&100>a.percent&&(b-=24);c.css("background-position","0 -"+b+"px");c.attr("class","countdisplay p"+10*Math.round(a.percent/10));a.table&&(e.length||(e=$('<div id="quotamenu" class="popupmenu">').appendTo($("body"))),e.html(a.table),c.css("cursor","pointer").off("click").on("click",function(a){return rcmail.command("menu-open",
"quotamenu",a.target,a)}));c='<table width="100%" style="background:transparent"><tr><td class="used" width="'+a.percent+'%"></td><td class="quota" width="'+(a.percent-100)+'%"></td></tr></table>';a.percent||(c='<table width="100%" style="background:transparent"><tr><td class="quota" width="100%"></td></tr></table>');$("#quotadisplay").append(c)}function H(a){$(".boxtitle a.search",a).click(function(c){var e=$(".boxtitle",a),b=$(".listsearchbox",a),d=b.is(":visible")?-1:1,f=34+($("select",b).length?
22:0);b.slideToggle({duration:160,progress:function(c,b){0>d&&(b=1-b);$(".scroller",a).css("top",e.outerHeight()+f*b+"px")},complete:function(){b.toggleClass("expanded");b.is(":visible")?(b.find("input[type=text]").focus(),f=34+($("select",b).length?$("select",b).outerHeight()+4:0),$(".scroller",a).css("top",e.outerHeight()+f+"px")):$("a.reset",b).click()}});return!1})}function N(a){"reply-list"==a.command&&1==rcmail.env.reply_all_mode?(a=rcmail.gettext(a.status?"replylist":"replyall"),"preview"==
rcmail.env.action?$("a.button.replyall").attr("title",a):$("a.button.reply-all").text(a).attr("title",a)):"compose-encrypted"==a.command&&$("a.button.encrypt").show()}function D(a,c){var e=x[a]=$("#"+a);e.appendTo(document.body);e.length&&(q[a]=$.extend(q[a]||{},c||{}))}function I(){$("#preview-shortheaders").toggle();var a=$("#preview-allheaders").toggle(),c=$("a#previewheaderstoggle");a.is(":visible")?c.attr("href","#hide").removeClass("add").addClass("remove").attr("aria-expanded","true"):c.attr("href",
"#details").removeClass("remove").addClass("add").attr("aria-expanded","false");k("previewheaders",a.is(":visible")?"1":"0")}function y(a,c){if(c||!$("#mail"+a+"mode").hasClass("disabled"))$("#maillistmode, #mailthreadmode").removeClass("selected").attr("tabindex","0").attr("aria-disabled","false"),$("#mail"+a+"mode").addClass("selected").attr("tabindex","-1").attr("aria-disabled","true")}function O(a){a=$("#"+a.name).find(".cmd_purge");var c=a.closest("ul").find(".skymail_purge"),e=rcmail.env.context_menu_source_id;
e==rcmail.env.trash_mailbox||e==rcmail.env.junk_mailbox?(a.show(),c.hide()):(a.hide(),c.show(),c.length||(c=$(a.get(0).outerHTML).attr("class","skymail_purge active").css("display","block").click(function(a){a.preventDefault();var c=rcmail.env.context_menu_source_id;P("*",c);rcmail.addEventListener("responsebeforemove",function(a){c==rcmail.env.mailbox&&rcmail.command("list",c)})}),a.closest("ul").append($('<li role="menuitem" />').append(c))))}function Q(a){a&&a.props&&"rcm_folderlist"==a.props.menu&&
O(a);z(a)}function P(a,c){function e(a){return rcmail.http_post(a,d,rcmail.display_message(rcmail.get_label("deletingmessage"),"loading"))}rcmail.message_list.select_first_disable=!0;var b=rcmail.env.trash_mailbox,d=rcmail.selection_post_data();"undefined"!=typeof c&&(d._mbox=c);d._uid=a;if(rcmail.env.flag_for_deletion)return rcmail.mark_message("delete",a),!1;b&&d._mbox!=b?rcmail.env.delete_junk&&rcmail.env.junk_mailbox&&d._mbox==rcmail.env.junk_mailbox?e("delete",d):(d._target_mbox=b,e("move",d)):
e("delete",d);rcmail.message_list.remove_row(a,rcmail.message_list.in_selection(a));rcmail.message_list.focus()}function z(a){if(a&&"messagelistmenu"==a.name)R(a);else if(a){var c=q[a.name]||{},e=$(c.link||"#"+a.name+"link"),b=a.obj&&a.obj.is(":visible");if(a.obj&&b&&e.length){var d=e.parent();$(window);d.hasClass("dropbutton")&&(e=d);if(c.above||e.hasClass("dropbutton"))d=e.offset(),a.obj.css({left:d.left+"px",top:d.top+(c.above?-a.obj.height():e.outerHeight())+"px"})}a.obj&&c.iconized&&a.obj.children("ul").addClass("iconized");
a.obj&&c.editable&&a.obj.attr("data-editable","true");"function"==typeof c.callback&&c.callback(b,a)}}function S(a,c){var e=a.parentNode.id.replace(/^attach/,"");$.each(["open","download","rename"],function(){var a=this;$("#attachmenu"+a).off("click").attr("onclick","").click(function(c){return rcmail.command(a+"-attachment",e,this)})});q.attachmentmenu.link=a;rcmail.command("menu-open",{menu:"attachmentmenu",id:e},a,c)}function J(a){a=$(a);a.children(".drop").length||a.append($('<a class="drop skip-content" tabindex="0" aria-haspopup="true">Show options</a>').on("click keypress",
function(a){if("keypress"!=a.type||13==rcube_event.get_keycode(a))return S(this,a),!1}))}function R(a){var c=$("#listoptions");c.is(":visible")?c.dialog("close",a.originalEvent):($('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",!0),$('input[name="sort_ord"][value="DESC"]').prop("checked","DESC"==rcmail.env.sort_order),$('input[name="sort_ord"][value="ASC"]').prop("checked","DESC"!=rcmail.env.sort_order),$.each(["widescreen","desktop","list"],function(){$('input[name="layout"][value="'+
this+'"]').prop("checked",rcmail.env.layout==this)}),$("#listoptions-columns",c)["widescreen"==rcmail.env.layout?"hide":"show"](),$('input[name="list_col[]"]').each(function(){$(this).prop("checked",-1!=$.inArray(this.value,rcmail.env.listcols))}),c.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:null,open:function(a){setTimeout(function(){c.find("a, input:not(:disabled)").not("[aria-disabled=true]").first().focus()},100)},close:function(a){c.dialog("destroy").hide();a.originalEvent&&rcube_event.is_keyboard(a.originalEvent)&&
$("#listmenulink").focus()},minWidth:500,width:c.width()+25}).show())}function T(a){$("#listoptions").dialog("close");rcube_event.is_keyboard(a.originalEvent)&&$("#listmenulink").focus();a=$('input[name="sort_col"]:checked').val();var c=$('input[name="sort_ord"]:checked').val(),e=$('input[name="layout"]:checked').val(),b=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(b,a,c,rcmail.env.threading,e)}function U(a){a=$("#contacts-table");var c=a.parent().css("overflow",
"hidden");a.clone().css({position:"absolute",top:"0",left:"0",width:a.width()+"px","z-index":10}).appendTo(c).animate({left:-(a.width()+5)+"px"},300,"swing",function(){$(this).remove();c.css("overflow","auto")})}function V(a){a=$("#contacts-table");var c=a.parent().css("overflow","hidden"),b=a.clone().appendTo(c);a.css({position:"absolute",top:"0",left:-(a.width()+5)+"px",width:a.width()+"px",height:a.height()+"px","z-index":10}).animate({left:"0"},300,"linear",function(){b.remove();$(this).css({position:"relative",
left:"0",width:"100%",height:"auto","z-index":1});c.css("overflow","auto")})}function A(a){var c=$("#upload-dialog");c.is(":visible")?c.dialog("close"):rcmail.mailvelope_editor||("compose"!=rcmail.env.action||c.data("extended")||c.data("extended",!0),c.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:c.attr("title"),open:function(a){document.all||c.data("noopenattach")||$("input[type=file]",c).first().click()},close:function(){try{$("#upload-dialog form").get(0).reset()}catch(e){}c.dialog("destroy").hide();
$("div.addline",c).remove()},width:"auto"}).show())}function B(a,c){var b=$(".compose-headers .line"+a);if(!b.is(":visible"))return E[a]&&!c&&$("#_"+a).val(E[a]),b.show(),$("a.add"+a+".iconlink").attr("onclick",'return UI.hide_header_row("'+a+'")'),g(),!1}function K(a,c){a=$(a);var b=a.get(0).id,d=a.children("fieldset");if(d.length){b||(b="rcmtabcontainer",a.attr("id",b));var f=$("<ul>").addClass("tabsbar").prependTo(a);d.each(function(a){var c=$(this),e=c.children("legend"),d=b+"-t"+a;var W=$("<a>").text(e.text()).attr("href",
"#"+d);a=$("<li>").addClass("tablink");e.remove();c.attr("id",d);a.append(W).appendTo(f)});a.tabs({active:c||0,heightStyle:"content",activate:function(a,c){g()}})}}var r={},x={},q={forwardmenu:{editable:1},searchmenu:{editable:1,callback:function(a){if(a&&rcmail.env.search_mods){var c;a=$('input:checkbox[name="s_mods[]"]',x.searchmenu);var b=rcmail.env.mailbox,d=rcmail.env.search_mods,f=rcmail.env.search_scope||"base";if("mail"==rcmail.env.task){"all"==f&&(b="*");d=d[b]?d[b]:d["*"];var g="text";$('input:radio[name="s_scope"]').prop("checked",
!1).filter("#s_scope_"+f).prop("checked",!0)}else g="*";if(d[g])a.map(function(){this.checked=!0;this.disabled=this.value!=g});else for(c in a.prop("disabled",!1).prop("checked",!1),d)$("#s_mod_"+c).prop("checked",!0)}}},attachmentmenu:{},listoptions:{editable:1},groupmenu:{above:1},mailboxmenu:{below:1},spellmenu:{callback:function(a,c){var b,d=rcmail.spellcheck_lang(),f=$("ul",c.obj);if(!f.length){f=$('<ul class="toolbarmenu selectable" role="menu">');for(b in rcmail.env.spell_langs){var g=$('<li role="menuitem">');
a=$('<a href="#'+b+'" tabindex="0"></a>').text(rcmail.env.spell_langs[b]).addClass("active").data("lang",b).on("click keypress",function(a){if("keypress"!=a.type||13==rcube_event.get_keycode(a))return rcmail.spellcheck_lang_set($(this).data("lang")),rcmail.hide_menu("spellmenu",a),!1});a.appendTo(g);g.appendTo(f)}f.appendTo(c.obj)}$("li",f).each(function(){var a=$("a",this);a.data("lang")==d?a.addClass("selected").attr("aria-selected","true"):a.hasClass("selected")&&a.removeClass("selected").removeAttr("aria-selected")})}},
"folder-selector":{iconized:1}},l=this,u,t,E={},p;this.set=function(a,c){r[a]=c};this.init=function(){rcmail.addEventListener("message",n);$("#taskbar a").each(function(a,c){$(c).append('<span class="tooltip">'+$(".button-inner",this).html()+"</span>")});$("#taskbar .minmodetoggle").click(function(a){a=$(document.body).toggleClass("minimal").hasClass("minimal");k("minimalmode",a?1:0);$(window).resize()});if("mail"==rcmail.env.task){rcmail.addEventListener("menu-open",Q).addEventListener("menu-close",
z).addEventListener("menu-save",T).addEventListener("enable-command",N).addEventListener("responseafterlist",function(a){y(rcmail.env.threading?"thread":"list",!0)}).addEventListener("responseaftersearch",function(a){y(rcmail.env.threading?"thread":"list",!0)});var a=$("#dragmessagemenu");a.length&&(rcmail.gui_object("dragmenu","dragmessagemenu"),x.dragmenu=a);if("show"==rcmail.env.action||"preview"==rcmail.env.action)rcmail.addEventListener("aftershow-headers",function(){f()}).addEventListener("afterhide-headers",
function(){f()}),$("#previewheaderstoggle").click(function(a){I();this.blur&&!rcube_event.is_keyboard(a)&&this.blur();return!1}),$("#attachment-list > li").each(function(){J(this)}),"1"==d("previewheaders")&&I(),"show"==rcmail.env.action&&$("#messagecontent").focus();else if("compose"==rcmail.env.action){"true"!==rcmail.env.paragraph_instead_newline&&(window.rcmail_editor_settings={forced_root_block:"div"});var c=window.setInterval(function(){"undefined"!==typeof rcmail.editor&&(p(),window.clearInterval(c))},
1E3),e='<div><br data-mce-bogus="1"></div>';e+=e+e;rcmail.addEventListener("change_identity",function(){var a=rcmail.editor.get_content();a=a.replace(/<div id="_rc_sig">/,e+'<div id="_rc_sig">').replace(/<p>(&nbsp;|\s+|<br\/?>)<\/p>/g,"");"remove"===rcmail.env.remove_signature_separator&&(a=a.replace(/<div id="_rc_sig">--[\s\-]{1}/,'<div id="_rc_sig">'));null!==rcmail.editor.editor&&rcmail.editor.editor.setContent(a)});rcmail.addEventListener("before-insert-sig",function(){var a=rcmail.editor.get_content();
a=a.replace(/<div id="_rc_sig">/,e+'<div id="_rc_sig">').replace(/<p>(&nbsp;|\s+|<br\/?>)<\/p>/g,"");"remove"===rcmail.env.remove_signature_separator&&(a=a.replace(/<div id="_rc_sig">/,'<div id="_rc_sig">-- '));rcmail.editor.editor.setContent(a)});var l=function(a){"true"!==rcmail.env.disable_ctrl_enter_sent&&(13!==a.keyCode&&10!==a.keyCode||!0!==a.ctrlKey||rcmail.command("send","",$(".button.send").get(0)))},p=function(){$(document).bind("keyup",function(a){$(a.target).closest("#composeheaders").get(0)&&
l(a)});$("#tinymce",$("#composebody_ifr").contents()).bind("keyup",function(a){$(this).addClass("keyupinitliazed");l(a)})};rcmail.addEventListener("aftersend-attachment",A).addEventListener("add-recipient",function(a){B(a.field,!0)}).addEventListener("aftertoggle-editor",function(a){window.setTimeout(function(){v()},200);window.setTimeout(function(){var a=$("#tinymce",$("#composebody_ifr").contents());a.hasClass("keyupinitliazed")||a.bind("keyup",function(a){$(this).addClass("keyupinitliazed");l(a)})},
1E3);a&&a.mode&&$("select[name='editorSelector']").val(a.mode)}).addEventListener("compose-encrypted",function(a){$("select[name='editorSelector']").prop("disabled",a.active);$("a.button.attach, a.button.responses")[a.active?"addClass":"removeClass"]("disabled");$("#responseslist a.insertresponse")[a.active?"removeClass":"addClass"]("active")});var q=["cc","bcc","replyto","followupto"];for(a=0;a<q.length;a++){var r=q[a];var t=$("#_"+r);t.length&&(t.on("change",{v:r},function(a){this.value&&B(a.data.v,
!0)}),""!=t.val()&&B(r,!0))}$("#composeoptionstoggle").click(function(a){var c=$("#composeoptions").toggle().is(":visible");$("#composeoptionstoggle").toggleClass("remove").attr("aria-expanded",c?"true":"false");v();k("composeoptions",c?"1":"0");rcube_event.is_keyboard(a)||this.blur();return!1}).css("cursor","pointer");"0"!==d("composeoptions")&&$("#composeoptionstoggle").click();$("textarea[name='_to'], textarea[name='_cc'], textarea[name='_bcc']").change(function(a){G(this)}).change();rcmail.addEventListener("autocomplete_insert",
function(a){G(a.field)});(a=rcmail.opener())&&"compose"==a.env.action&&$("#composeoptionstoggle",opener.document).hasClass("remove")&&$("#composeoptionstoggle").click();(new rcube_splitter({id:"composesplitterv",p1:"#composeview-left",p2:"#composeview-right",orientation:"v",relative:!0,start:206,min:170,size:12,render:v})).init();$("#attachment-list > li").each(function(){J(this)})}else"list"!=rcmail.env.action&&rcmail.env.action?"get"==rcmail.env.action&&(new rcube_splitter({id:"mailpartsplitterv",
p1:"#messagepartheader",p2:"#messagepartcontainer",orientation:"v",relative:!0,start:226,min:150,size:12})).init():(rcmail.addEventListener("init",function(){rcmail.addEventListener("listupdate",function(a){if("undefined"!=typeof a.folder&&!rcmail.message_list.select_first_disable){if("undefined"!==typeof rcmail.env.selectfirst&&"noselect"==rcmail.env.selectfirst)return;rcmail.message_list.get_single_selection()||rcmail.message_list.select_first(rcube_event.get_modifier(a))}rcmail.message_list.select_first_disable=
!1})}),b(),$("#maillistmode").addClass(rcmail.env.threading?"":"selected").click(function(a){y("list");return!1}),$("#mailthreadmode").addClass(rcmail.env.threading?"selected":"").click(function(a){y("thread");return!1}),m(),rcmail.init_pagejumper("#pagejumper"),rcmail.addEventListener("setquota",C).addEventListener("layout-change",b).addEventListener("afterimport-messages",A));$("#mailview-left").length&&(new rcube_splitter({id:"mailviewsplitterv",p1:"#mailview-left",p2:"#mailview-right",orientation:"v",
relative:!0,start:206,min:150,size:12,callback:M,render:F})).init()}else if("settings"==rcmail.env.task)if(rcmail.addEventListener("init",function(){var a="#settingstabpreferences";rcmail.env.action&&(a="#settingstab"+(0<rcmail.env.action.indexOf("identity")?"identities":rcmail.env.action.replace(/\./g,"")));$(a).addClass("selected").children().first().removeAttr("onclick").click(function(){return!1});a={select_first:function(){}};"undefined"!==typeof rcmail.sections_list&&(a=rcmail.sections_list);
"identities"===rcmail.env.action&&(a=rcmail.identity_list);"responses"===rcmail.env.action&&(a=rcmail.responses_list);a.select_first()}),"folders"==rcmail.env.action)(new rcube_splitter({id:"folderviewsplitter",p1:"#folderslist",p2:"#folder-details",orientation:"v",relative:!0,start:266,min:180,size:12})).init(),rcmail.addEventListener("setquota",C),H($("#folderslist"));else if("identities"==rcmail.env.action)(new rcube_splitter({id:"identviewsplitter",p1:"#identitieslist",p2:"#identity-details",
orientation:"v",relative:!0,start:266,min:180,size:12})).init();else if("responses"==rcmail.env.action)(new rcube_splitter({id:"responseviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:!0,start:266,min:180,size:12})).init();else if("preferences"==rcmail.env.action||!rcmail.env.action)(new rcube_splitter({id:"prefviewsplitter",p1:"#sectionslist",p2:"#preferences-box",orientation:"v",relative:!0,start:266,min:180,size:12})).init();else{if("edit-prefs"==rcmail.env.action){a=
$("#preferences-details fieldset.advanced legend");var u=$('<a href="#toggle"></a>').text(rcmail.gettext("toggleadvancedoptions")).attr("title",rcmail.gettext("toggleadvancedoptions")).addClass("advanced-toggle");a.click(function(a){u.html($(this).hasClass("collapsed")?"&#9650;":"&#9660;");$(this).toggleClass("collapsed").closest("fieldset").children(".propform").toggle()}).append(u).addClass("collapsed");bw.mz&&a.parents("form").css("display","inline")}}else"addressbook"==rcmail.env.task&&(rcmail.addEventListener("afterupload-photo",
A).addEventListener("beforepushgroup",U).addEventListener("beforepopgroup",V).addEventListener("menu-open",z).addEventListener("menu-close",z),""==rcmail.env.action&&((new rcube_splitter({id:"addressviewsplitterd",p1:"#addressview-left",p2:"#addressview-right",orientation:"v",relative:!0,start:206,min:150,size:12,render:F})).init(),(new rcube_splitter({id:"addressviewsplitter",p1:"#addresslist",p2:"#contacts-box",orientation:"v",relative:!0,start:266,min:260,size:12})).init()),a=$("#dragcontactmenu"),
a.length&&(rcmail.gui_object("dragmenu","dragcontactmenu"),x.dragmenu=a));$(".tabbed").each(function(a,c){K(c)});$("select.decorated").each(function(){if(bw.opera)$(this).removeClass("decorated");else{var a=$(this),c=a.parent(),b=Math.max(a.height(),26)-2,e=a.width()-22,d=$("option",this).first().text();""!=$("option:selected",this).val()&&(d=$("option:selected",this).text());var f=$('<a class="menuselector" tabindex="-1"><span class="handle">'+d+"</span></a>").css("position","absolute").offset(a.position()).insertAfter(a);
f.children().width(e).height(b).css("line-height",b-1+"px");"absolute"!=c.css("position")&&c.css("position","relative");a.width(f.width()).on(bw.mz?"change keyup":"change",function(){var a=$("option:selected",this).text();$(this).next().children().text(a)});a.on("focus",function(a){f.addClass("focus")}).on("blur",function(a){f.removeClass("focus")})}});a=$("body.minwidth");a.length&&a.css("min-width",$(".toolbar").width()+$("#quicksearchbar").width()+$("#searchfilter").width()+30);window.addEventListener("resize",
g);window.resize=g;g()};this.init_tabs=K;this.show_about=function(a){var c=$("<iframe>").attr({id:"aboutframe",src:rcmail.url("settings/about"),frameborder:"0"});h=Math.floor(.75*$(window).height());buttons={};supportln=$("#supportlink");supportln.length&&(r.supporturl=supportln.attr("href"))&&(buttons[supportln.html()]=function(a){0>r.supporturl.indexOf("mailto:")?window.open(r.supporturl):location.href=r.supporturl});c.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:a?a.title||a.innerHTML:
null,close:function(){c.dialog("destroy").remove()},buttons:buttons,width:640,height:h}).width(640)};this.show_popup=function(a,c,b){!b&&q[a]||D(a,b);b=q[a]||{};b=$(b.link?b.link:"#"+a+"link");var e=b.offset();b.has(".inner")&&(b=b.children(".inner"));$("#"+a+" ul span, #"+a+" ul a").removeClass("icon");return rcmail.command("menu-open",{menu:a,show:c},b.get(0),$.Event("click",{target:b.get(0),pageX:e.left,pageY:e.top,clientX:e.left,clientY:e.top}))};this.toggle_popup=function(a,b,e){!e&&q[a]||D(a,
e);return rcmail.command("menu-open",a,b.target,b)};this.add_popup=D;this.set_searchmod=function(a){var b=rcmail.env.task;var e=rcmail.env.search_mods,d=rcmail.env.mailbox;"all"==$('input[name="s_scope"]:checked').val()&&(d="*");e||(e={});if("mail"==b){e[d]||(e[d]=rcube_clone_object(e["*"]));var f=e[d];b="text"}else f=e,b="*";a.checked?f[a.value]=1:delete f[a.value];a.value==b&&$('input:checkbox[name="s_mods[]"]').map(function(){this!=a&&(this.checked=!0,a.checked?(this.disabled=!0,delete f[this.value]):
(this.disabled=!1,f[this.value]=1))});rcmail.set_searchmods(f)};this.set_searchscope=function(a){rcmail.set_searchscope(a.value)};this.show_uploadform=A;this.show_header_row=B;this.hide_header_row=function(a){var b=$("#_"+a);E[a]=b.val();b.val("");$(".compose-headers .line"+a).hide();$("a.add"+a+".iconlink").attr("onclick",'return UI.show_header_row("'+a+'")');v();return!1};this.update_quota=C;this.get_pref=d;this.save_pref=k;this.folder_search_init=H;if(window.$&&document.body){var L=d("minimalmode");
(parseInt(L)||null===L&&850>$(window).height())&&$(document.body).addClass("minimal");bw.tablet&&$("#viewport").attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0");$(document).ready(function(){l.init()})}}
function rcube_scroller(d,m,k){var g=this;this.list=$(d);this.top=$(m);this.bottom=$(k);this.step_size=6;this.step_time=20;this.delay=500;this.top.mouseenter(function(){rcmail.drag_active&&(g.ts=window.setTimeout(function(){g.scroll("down")},g.delay))}).mouseout(function(){g.ts&&window.clearTimeout(g.ts)});this.bottom.mouseenter(function(){rcmail.drag_active&&(g.ts=window.setTimeout(function(){g.scroll("up")},g.delay))}).mouseout(function(){g.ts&&window.clearTimeout(g.ts)});this.scroll=function(d){var b=
this,f=this.step_size;rcmail.drag_active&&("down"==d&&(f*=-1),this.list.get(0).scrollTop+=f,this.ts=window.setTimeout(function(){b.scroll(d)},this.step_time))}}
function rcube_splitter(d){function m(d){if(bw.konq||bw.chrome||bw.safari)document.body.style.webkitUserSelect="none";b.p1pos=b.relative?b.p1.position():b.p1.offset();b.p2pos=b.relative?b.p2.position():b.p2.offset();b.drag_active=!0;$(document).on("mousemove."+this.id,k).on("mouseup."+this.id,g);rcmail.message_list&&(rcmail.message_list.drag_active=!0);$("iframe").each(function(b,d){$("<div>").attr("id","iframe-splitter-fix-"+b).addClass("iframe-splitter-fix").css({background:"#fff",width:d.offsetWidth+
"px",height:d.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css($(this).offset()).appendTo("body")})}function k(d){if(!b.drag_active)return!1;window.clearTimeout(b.ts);b.ts=window.setTimeout(function(){var f=rcube_event.get_mouse_pos(d);if(b.relative){var g=b.parent.offset();f.x-=g.left;f.y-=g.top}b.horizontal?f.y-b.halfsize>b.p1pos.top&&f.y+b.halfsize<b.p2pos.top+b.p2.outerHeight()&&(b.pos=Math.max(b.min,f.y-Math.max(0,b.offset)),b.pos>b.min&&(b.pos=Math.min(b.pos,b.parent.height()-
b.min)),b.resize()):f.x-b.halfsize>b.p1pos.left&&f.x+b.halfsize<b.p2pos.left+b.p2.outerWidth()&&(b.pos=Math.max(b.min,f.x-Math.max(0,b.offset)),b.pos>b.min&&(b.pos=Math.min(b.pos,b.parent.width()-b.min)),b.resize());b.p1pos=b.relative?b.p1.position():b.p1.offset();b.p2pos=b.relative?b.p2.position():b.p2.offset()},1);return!1}function g(d){if(bw.konq||bw.chrome||bw.safari)document.body.style.webkitUserSelect="auto";$(document).off("."+b.id);b.drag_active=!1;rcmail.message_list&&(rcmail.message_list.drag_active=
!1);$("div.iframe-splitter-fix").remove();b.set_cookie();"function"==typeof b.callback&&b.callback(b);return bw.safari?!0:rcube_event.cancel(d)}function n(d){b.horizontal?(d=parseInt(b.parent.outerHeight(),10)-parseInt(b.p2[0].style.top,10),b.p2.css("height",(0<d?d:0)+"px")):(d=parseInt(b.parent.outerWidth(),10)-parseInt(b.p2[0].style.left,10),b.p2.css("width",(0<d?d:0)+"px"))}this.p=d;this.id=d.id;this.horizontal="horizontal"==d.orientation||"h"==d.orientation;this.halfsize=(void 0!==d.size?d.size:
10)/2;this.pos=d.start||0;this.min=d.min||20;this.offset=d.offset||0;this.relative=d.relative?!0:!1;this.drag_active=!1;this.render=d.render;this.callback=d.callback;var b=this;rcube_splitter._instances[this.id]=b;this.init=function(){this.p1=$(this.p.p1);this.p2=$(this.p.p2);this.parent=this.p1.parent();if(this.p1.length&&this.p2.length){this.p1pos=this.relative?this.p1.position():this.p1.offset();this.p2pos=this.relative?this.p2.position():this.p2.offset();this.handle=$("<div>").attr("id",this.id).attr("unselectable",
"on").attr("role","presentation").addClass("splitter "+(this.horizontal?"splitter-h":"splitter-v")).appendTo(this.parent).mousedown(m);if(this.horizontal){var b=this.p1pos.top+this.p1.outerHeight();this.handle.css({left:"0px",top:b+"px"})}else b=this.p1pos.left+this.p1.outerWidth(),this.handle.css({left:b+"px",top:"0px"});bw.ie&&$(window).resize(n);(b=this.get_cookie())&&!isNaN(b)?(this.pos=parseFloat(b),this.resize()):this.pos&&(this.resize(),this.set_cookie())}};this.resize=function(){if(this.horizontal){if(this.p1.css("height",
Math.floor(this.pos-this.p1pos.top-Math.floor(this.halfsize))+8+"px"),this.p2.css("top",Math.ceil(this.pos+Math.ceil(this.halfsize))-4+"px"),this.handle.css("top",Math.round(this.pos-this.halfsize+this.offset)+"px"),bw.ie){var b=parseInt(this.parent.outerHeight(),10)-parseInt(this.p2.css("top"),10);this.p2.css("height",(0<b?b:0)+"px")}}else this.p1.css("width",Math.floor(this.pos-this.p1pos.left-Math.floor(this.halfsize))+5+"px"),this.p2.css("left",Math.ceil(this.pos+Math.ceil(this.halfsize))-7+"px"),
this.handle.css("left",Math.round(this.pos-this.halfsize+this.offset)+"px"),bw.ie&&(b=parseInt(this.parent.outerWidth(),10)-parseInt(this.p2.css("left"),10),this.p2.css("width",(0<b?b:0)+"px"));this.p2.resize();this.p1.resize();this.drag_active&&$("iframe").each(function(b,d){var f=$(this).offset();$("#iframe-splitter-fix-"+b).css({top:f.top+"px",left:f.left+"px",width:d.offsetWidth+"px",height:d.offsetHeight+"px"})});"function"==typeof this.render&&this.render(this)};this.get_cookie=function(){return window.UI?
UI.get_pref(this.id):null};this.set_cookie=function(){window.UI&&UI.save_pref(this.id,this.pos)}}rcube_splitter._instances={};rcube_splitter.get_instance=function(d){return rcube_splitter._instances[d]};
